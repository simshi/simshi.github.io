<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>Self-Cultivation of A Coder - What's the difference between `foo(void)` and `foo(void)`?</title>
        <link rel="stylesheet" type="text/css" href="../css/default.css" />
    </head>
    <body>
        <div id="header">
            <div id="logo">
                <a href="../">Self-Cultivation of A Coder</a>
            </div>
            <div id="navigation">
                <a href="../about.html">About</a>
                <a href="../archive.html">Archive</a>
            </div>
        </div>

        <div id="content">
            <h1>What's the difference between `foo(void)` and `foo(void)`?</h1>

            <div class="info">
	Posted on January 13, 2013
	
</div>

<div class="figure">
<img src="http://imgs.xkcd.com/comics/debugger.png" />

</div>
<h2 id="problem">Problem</h2>
<p>Let’s begin with a little bit of C code:</p>
<pre class="sourceCode c"><code class="sourceCode c"><span class="co">//void.h</span>
<span class="dt">int</span> foo();

<span class="co">//void.c</span>
<span class="dt">int</span> foo(<span class="dt">int</span> x)
{
    <span class="kw">return</span> x<span class="dv">+1</span>;
}

<span class="co">//main.c</span>
<span class="ot">#include &lt;stdio.h&gt;</span>
<span class="ot">#include &quot;void.h&quot;</span>

<span class="dt">int</span> main()
{
    printf(<span class="st">&quot;foo:%d</span><span class="ch">\n</span><span class="st">&quot;</span>, foo());
    <span class="kw">return</span> <span class="dv">0</span>;
}</code></pre>
<p>Use below command to compile and link them together:</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">gcc</span> *.c -o void -Wall -Wextra</code></pre>
<p>Which result do you expect?</p>
<ol style="list-style-type: decimal">
<li>gcc warns about unmatched prototypes of ‘foo’;</li>
<li>compilation is OK, but run the ‘./void’ results into a ‘segmentation fault’;</li>
<li>compilation is OK, but run the ‘./void’ prints a random value.</li>
</ol>
<blockquote>
<p>. . . . . . . .</p>
</blockquote>
<p>The result is the 3rd one in my environment, gcc gives no warnings on this piece of code, the result is random, but it works without any segmentation fault.</p>
<h2 id="analysis">Analysis</h2>
<p>The mumbo-jumbo behind it is how gcc inteprete the decleraration in <code>void.h</code>, as ANSI C mentioned:</p>
<blockquote>
<p>The empty list in a function declarator that is not part of a function definition specifies that no information about the number or types of the parameters is supplied.</p>
</blockquote>
<p>As it implies, the declaration <code>int foo();</code> in <code>foo.h</code> <strong>doesn’t mean <code>foo</code> has no parameter, it means not specified</strong>. Hence, gcc accepts it because it doesn’t conflict with <code>int foo(int x)</code> (though the result is unexpected).</p>
<p>The story can’t endup here, next question should be how to express a funtion doesn’t have any parameter?</p>
<p>Let’s refer to ANSI C paper again:</p>
<blockquote>
<p>The special case of void as the only item in the list specifies that the function has no parameters.</p>
</blockquote>
<p>No surperise what the above code actually saying is <code>int foo(void);</code>.</p>
<h2 id="solution">Solution</h2>
<p>But you can imagine if this scenario happened it might cost an engineer lots of time to debug. How to avoid such boring things? The GCC compile option <code>-Wstrict-prototypes</code> is a simple and elegent method you’re looking for:</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">gcc</span> *.c -o void -Wall -Wextra -Wstrict-prototypes</code></pre>
<p>now gcc generates warnings like:</p>
<blockquote>
<p>void.h:1: warning: function declaration isn’t a prototype</p>
</blockquote>
<p>It helps you to find all those potential issues.</p>
<h2 id="note">Note</h2>
<ul>
<li>C++ works on strict prototypes by default, so <code>int foo();</code> has the same meaning with <code>int foo(void);</code> in C++;</li>
<li>Some compilers don’t generate any warning in my test, please find documents here if you want to know more.</li>
<li>Check out compiling tactics at <a href="../posts/2013-02-26-compiler-warnings-are-your-friends.html">Compiler Warnings are Your Friends</a>.</li>
</ul>
<p><em>Many thanks to <a href="http://xkcd.com">xkcd.com</a> for the comic at begin, along with many other instresting comics, and its kind <a href="https://xkcd.com/license.html">license</a>.</em></p>


        </div>
        <div id="footer">
            Site proudly generated by
            <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>
    </body>
</html>
